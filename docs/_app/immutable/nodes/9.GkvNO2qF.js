import"../chunks/CWj6FrbW.js";import{o as ka}from"../chunks/C9-cIV3B.js";import{an as $a,p as xa,ao as q,U as X,ah as sa,ap as ya,ak as e,aj as n,t as Y,ai as Z,a as za,V as m,k as o,al as p,am as t,aq as Ua}from"../chunks/D59Xova2.js";import{e as Ba,i as Aa}from"../chunks/BEGNetRX.js";import{s as aa}from"../chunks/6FIbrPCm.js";import{s as Da}from"../chunks/CVC4n5oh.js";import{b as Ma}from"../chunks/BR9wmZYp.js";import{s as Fa,a as ta}from"../chunks/CNRbxWRS.js";import{S as Sa,N as La,F as Oa}from"../chunks/CCD8xTFC.js";import{a as ea}from"../chunks/B4IBGgww.js";import{g as ja}from"../chunks/CIVZvu2x.js";import{$ as Ra}from"../chunks/whDgBzMN.js";var Ca=sa('<div class="backup-item svelte-maq4gq"><div class="game-info svelte-maq4gq"><div class="game-icon svelte-maq4gq"><i class="fa-solid fa-gamepad"></i></div> <div class="game-details svelte-maq4gq"><h3 class="svelte-maq4gq"> </h3> <div class="meta svelte-maq4gq"><span class="platform svelte-maq4gq"> </span> <span class="date"> </span> <span class="size"> </span></div></div></div> <div class="actions svelte-maq4gq"><button class="btn-secondary svelte-maq4gq"><i class="fa-solid fa-download"></i> Download</button> <button class="btn-primary svelte-maq4gq"><i class="fa-solid fa-desktop"></i> Open in App</button></div></div>'),Ga=sa('<!> <div class="page-wrapper svelte-maq4gq"><!> <main class="profile-container svelte-maq4gq"><div class="profile-header svelte-maq4gq"><div class="user-info svelte-maq4gq"><img class="avatar svelte-maq4gq"/> <div class="user-details svelte-maq4gq"><h1 class="svelte-maq4gq"> </h1> <p class="svelte-maq4gq"> </p></div></div> <div class="stats svelte-maq4gq"><div class="stat-item svelte-maq4gq"><span class="stat-value svelte-maq4gq"> </span> <span class="stat-label svelte-maq4gq">Backups</span></div> <div class="stat-item svelte-maq4gq"><span class="stat-value svelte-maq4gq">2.1 MB</span> <span class="stat-label svelte-maq4gq">Total Size</span></div> <div class="stat-item svelte-maq4gq"><span> </span> <div class="backups-section svelte-maq4gq"><div class="section-header svelte-maq4gq"><h2 class="svelte-maq4gq">My Game Backups</h2> <div class="upload-actions"><input type="file" accept=".zip" style="display: none;"/> <button class="btn-primary svelte-maq4gq"><i class="fa-solid fa-upload"></i> </button></div></div> <div class="backups-list svelte-maq4gq"></div></div></div></div></div></main> <!></div>',1);function Ya(ia,ra){xa(ra,!0);const A=()=>ta(ea,"$auth",M),D=()=>ta(Ra,"$t",M),[M,oa]=Fa();let c=q(X({name:"",email:"",avatar:"",subscription:{status:"inactive",plan:"none",expiresAt:null}})),_=q(X([])),u,f=q(!1),F=q(!1);ka(async()=>ea.subscribe(a=>{var i,s,l,v;if(!a.isAuthenticated){ja("/auth");return}m(c,{...o(c),name:((s=(i=a.user)==null?void 0:i.email)==null?void 0:s.split("@")[0])||"User",email:((l=a.user)==null?void 0:l.email)||"",avatar:`https://ui-avatars.com/api/?name=${((v=a.user)==null?void 0:v.email)||"User"}&background=6366f1&color=fff`},!0),S(a.token),na(a.token)}));async function na(r){try{const a=await fetch("http://localhost:8000/api/subscription",{headers:{Authorization:`Bearer ${r}`}});if(a.ok){const i=await a.json();o(c).subscription={status:i.subscription_status,plan:i.subscription_plan,expiresAt:i.subscription_expires_at?new Date(i.subscription_expires_at).toLocaleDateString():null}}}catch(a){console.error("Failed to fetch subscription",a)}}async function S(r){try{const a=await fetch("http://localhost:8000/api/saves",{headers:{Authorization:`Bearer ${r}`}});if(a.ok){const i=await a.json();m(_,i.map(s=>({id:s.ID,game:s.game_name,platform:s.platform,date:new Date(s.CreatedAt).toLocaleDateString(),size:la(s.size),image:"https://images.igdb.com/igdb/image/upload/t_cover_big/co65u5.webp"})),!0)}}catch(a){console.error("Failed to fetch backups",a)}}function la(r){if(r===0)return"0 B";const a=1024,i=["B","KB","MB","GB"],s=Math.floor(Math.log(r)/Math.log(a));return parseFloat((r/Math.pow(a,s)).toFixed(2))+" "+i[s]}async function ca(r,a){const i=A().token;try{const s=await fetch(`http://localhost:8000/api/saves/${r}/download`,{headers:{Authorization:`Bearer ${i}`}});if(s.ok){const l=await s.blob(),v=window.URL.createObjectURL(l),d=document.createElement("a");d.href=v,d.download=`${a}.zip`,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(v),d.remove()}else alert("Failed to download save")}catch(s){console.error("Download error",s)}}function va(r){window.location.href=`memorycard://game/${r}`}async function pa(r){const a=r.target.files[0];if(!a)return;m(f,!0);const i=new FormData;i.append("file",a),i.append("game_name",a.name.replace(".zip","")),i.append("platform","Unknown");const s=A().token;try{(await fetch("http://localhost:8000/api/saves",{method:"POST",headers:{Authorization:`Bearer ${s}`},body:i})).ok?(await S(s),alert("Upload successful!")):alert("Upload failed")}catch(l){console.error("Upload error",l),alert("Upload error")}finally{m(f,!1),u.value=""}}var L=Ga(),O=ya(L);Sa(O,{get isOpen(){return o(F)},$$events:{close:()=>m(F,!1)}});var j=n(O,2),R=e(j);La(R,{});var b=n(R,2),C=e(b),w=e(C),k=e(w),G=n(k,2),$=e(G),da=e($,!0);t($);var I=n($,2),ma=e(I,!0);t(I),t(G),t(w);var N=n(w,2),x=e(N),T=e(x),ua=e(T,!0);t(T),Ua(2),t(x);var E=n(x,4),g=e(E),fa=e(g,!0);t(g);var K=n(g,2),y=e(K),P=n(e(y),2),z=e(P);z.__change=pa,Ma(z,r=>u=r,()=>u);var h=n(z,2);h.__click=()=>u.click();var ga=n(e(h));t(h),t(P),t(y);var V=n(y,2);Ba(V,21,()=>o(_),Aa,(r,a)=>{var i=Ca(),s=e(i),l=n(e(s),2),v=e(l),d=e(v,!0);t(v);var H=n(v,2),U=e(H),qa=e(U,!0);t(U);var B=n(U,2),_a=e(B,!0);t(B);var J=n(B,2),ba=e(J,!0);t(J),t(H),t(l),t(s);var Q=n(s,2),W=e(Q);W.__click=()=>ca(o(a).id,o(a).game);var wa=n(W,2);wa.__click=()=>va(o(a).game),t(Q),t(i),Y(()=>{p(d,o(a).game),p(qa,o(a).platform),p(_a,o(a).date),p(ba,o(a).size)}),Z(r,i)}),t(V),t(K),t(E),t(N),t(C),t(b);var ha=n(b,2);Oa(ha,{}),t(j),Y(r=>{aa(k,"src",o(c).avatar),aa(k,"alt",o(c).name),p(da,o(c).name),p(ma,o(c).email),p(ua,o(_).length),Da(g,1,`stat-value ${o(c).subscription.status==="active"?"text-green-400":"text-zinc-400"}`,"svelte-maq4gq"),p(fa,r),h.disabled=o(f),p(ga,` ${o(f)?"Uploading...":"Upload Save"}`)},[()=>o(c).subscription.status==="active"?D()("subscription.active"):D()("subscription.inactive")]),Z(ia,L),za(),oa()}$a(["change","click"]);export{Ya as component};
